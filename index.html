<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Proxy Scraper - IP Only</title>
<style>
  body { font-family: system-ui, sans-serif; max-width: 900px; margin: 40px auto; padding: 16px; background: #f8f8f8; }
  h1 { font-size: 1.6rem; }
  textarea { width: 100%; height: 180px; font-family: monospace; border-radius: 8px; padding: 8px; border: 1px solid #ccc; }
  button { padding: 10px 14px; font-size: 15px; border: none; border-radius: 8px; background: #0078ff; color: #fff; cursor: pointer; }
  button:disabled { opacity: 0.5; cursor: default; }
  .log { margin-top: 15px; padding: 10px; background: #fff; border: 1px solid #ddd; border-radius: 8px; white-space: pre-wrap; height: 150px; overflow-y: auto; font-size: 14px; }
</style>
</head>

<body>
  <h1>Proxy Scraper (IP Only)</h1>
  <p>Masukkan daftar URL proxy (satu per baris). Hasil akan diekspor sebagai <b>proxy.txt</b> berisi hanya alamat IP (tanpa port / protokol).</p>

  <textarea id="urls" placeholder="https://example.com/proxylist.txt
https://example.net/socks5.txt"></textarea>
  <br><br>
  <button id="start">Scrape & Download proxy.txt</button>
  <span id="status" style="margin-left:10px;color:#555"></span>

  <div class="log" id="log"></div>

<!-- ðŸš€ SCRIPT DITARUH PALING BAWAH -->
<script>
  const $ = id => document.getElementById(id);
  const log = msg => ($('#log').textContent += msg + "\\n");

  function cleanProtocols(text) {
    // hapus http://, https://, socks4://, socks5://, user:pass@
    return text.replace(/\\b(?:https?|socks[45]?):\\/\\/(?:\\S+@)?/gi, '');
  }

  async function fetchText(url, timeout = 15000) {
    const controller = new AbortController();
    const id = setTimeout(() => controller.abort(), timeout);
    try {
      const res = await fetch(url, { signal: controller.signal });
      return await res.text();
    } finally { clearTimeout(id); }
  }

  async function startScrape() {
    const input = $('#urls').value.trim().split(/\\r?\\n/).map(x=>x.trim()).filter(Boolean);
    if (!input.length) return alert('Masukkan minimal 1 URL!');
    $('#start').disabled = true;
    $('#log').textContent = '';
    $('#status').textContent = 'Sedang memproses...';

    const allIps = new Set();
    const regex = /\\b((?:\\d{1,3}\\.){3}\\d{1,3})(?::\\d{1,5})?\\b/g;

    for (const url of input) {
      log('ðŸ” Fetch: ' + url);
      try {
        const txt = await fetchText(url);
        const cleaned = cleanProtocols(txt);
        let m;
        while ((m = regex.exec(cleaned)) !== null) {
          const ip = m[1];
          const octets = ip.split('.').map(Number);
          const valid = octets.length === 4 && octets.every(o=>o>=0&&o<=255);
          if (valid) allIps.add(ip);
        }
      } catch (e) {
        log('âŒ Gagal ambil ' + url + ' (' + e.message + ')');
      }
    }

    const result = Array.from(allIps).sort();
    if (result.length === 0) {
      log("âš ï¸ Tidak ada IP ditemukan.");
      $('#status').textContent = 'Selesai (tidak ada IP).';
      $('#start').disabled = false;
      return;
    }

    const blob = new Blob([result.join('\\n')], { type: 'text/plain' });
    const a = document.createElement('a');
    a.href = URL.createObjectURL(blob);
    a.download = 'proxy.txt';
    a.click();
    URL.revokeObjectURL(a.href);

    $('#status').textContent = 'âœ… Selesai (' + result.length + ' IP ditemukan)';
    log('Selesai. File proxy.txt diunduh (' + result.length + ' IP).');
    $('#start').disabled = false;
  }

  // pasang event listener SETELAH DOM terbentuk
  document.addEventListener('DOMContentLoaded', () => {
    $('#start').addEventListener('click', startScrape);
  });
</script>
</body>
</html>
